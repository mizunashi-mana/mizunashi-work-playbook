<match {{ item }}>
  @type elasticsearch

  scheme {{ fluentd_output_elasticsearch_scheme }}
  host {{ fluentd_output_elasticsearch_domain }}
  port {{ fluentd_output_elasticsearch_port }}
  ca_file {{ fluentd_output_elasticsearch_ca_file }}

  user {{ fluentd_output_elasticsearch_user_name }}
  password {{ fluentd_output_elasticsearch_user_password }}

  logstash_format true
  logstash_prefix fluentd-{{ item }}-#{Socket.gethostname}

  <buffer>
    @type file

    chunk_limit_size 1m
    total_limit_size 512m

    retry_type exponential_backoff
    retry_max_times 2
    retry_max_interval 30

    flush_mode interval
    flush_interval 10s

    overflow_action drop_oldest_chunk
  </buffer>
</match>
