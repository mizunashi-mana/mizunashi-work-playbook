#!/usr/bin/env bash

set -euxo

if [ -n "$REQUESTS_CA_BUNDLE" ]; then
  export REQUESTS_CA_BUNDLE="$REQUESTS_CA_BUNDLE"
fi

certbot renew --cert-name "$DOMAIN"

CERT_DIR="/etc/letsencrypt/live/$DOMAIN"

if [ -e "$CERT_DIR/cert.pem" ] && [ -e "$CERT_DIR/privkey.pem" ] && [ -e "$CERT_DIR/chain.pem" ]
then
  echo "Certificates are not available."
  exit 1
fi

/usr/local/bin/node_exporter_custom_collector -c 'echo' \
  -d "$DESTINATION_PROMFILE"
