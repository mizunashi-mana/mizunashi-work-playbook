import "mizunashi.work/pkg/roles/openssh_server"
import "mizunashi.work/pkg/roles/nftables"
import "mizunashi.work/pkg/roles/fail2ban"
import "mizunashi.work/pkg/roles/nginx"
import "mizunashi.work/pkg/roles/mastodon"
import "mizunashi.work/pkg/roles/nginx_exporter"
import "mizunashi.work/pkg/roles/private_ca"
import "mizunashi.work/pkg/roles/prometheus"
import "mizunashi.work/pkg/roles/nginx_site_http_redirector"
import "mizunashi.work/pkg/roles/nginx_site_mastodon_front"
import "mizunashi.work/pkg/roles/postgresql_mastodon"
import "mizunashi.work/pkg/roles/private_mastodon_certificate"

#Schema: fail2ban
#Schema: nftables
#Schema: openssh_server
#Schema: nginx
#Schema: mastodon
#Schema: nginx_exporter
#Schema: private_ca
#Schema: prometheus
#Schema: nginx_site_http_redirector
#Schema: nginx_site_mastodon_front
#Schema: postgresql_mastodon
#Schema: private_mastodon_certificate

let mastodon_domain = "mstdn-local.mizunashi.work"
let ssh_port = 22
let http_port = 80
let https_port = 443

#Schema & {
  mastodon_local_domain: mastodon_domain
  mastodon_single_user_mode: "true"

  mastodon_db_user_password: {
    "__ansible_vault":
      """
      $ANSIBLE_VAULT;1.1;AES256
      65333663363039383963396135643335373032636437653730356635613734303434336534323136
      3135363037306231643964396337663435643266633566340a616137393839323333353332626462
      61383633343664306232393766613635303962303237626231333734313236646562626261386130
      3263663039376435390a383532326435363036646533393639356536626539333530343835653961
      30333436616561303861653761613238316162316430626664326662646135643737
      """
  }

  mastodon_secret_key_base: {
    "__ansible_vault":
      """
      $ANSIBLE_VAULT;1.1;AES256
      37323735323835666638353864626536386338613863303661353730646536393933363461383966
      6336356634633339333663626633333332613531303335360a396261366231393265646533323662
      30356632643331356139306366663836346663666465353766613435373330396464366530363933
      6537373534666665340a663637613064373063363437653433663365393161643538306537316664
      62386238663461633337623834633333393533636539373862303430396434616232353261303535
      66343935303935333730376362313135353265326565303864393664326235353535373235316365
      35363361623862323937633534383634343131303365623737343435363337656161363634386138
      38306135346363316432663163353565353930366462373131646264373930303964636165653530
      36303465343339366666613431323330396666373533666331646334613231346264356164636265
      37656131303933383936636166323733346130356635343839663336376136303336353662633637
      313237396237633536333036346435313630
      """
  }
  mastodon_otp_secret: {
    "__ansible_vault":
      """
      $ANSIBLE_VAULT;1.1;AES256
      35653533633464366161633961323035323261643130386638626237346261643763346464613933
      3832646163646264303434626237386533666638383336660a353939396531646333643065393263
      61626465323632633233346132646265346635616561636536376430323932373661343132623261
      3565613431656666620a363431626161303466383235366432393734323961666331306532616366
      35613137323564303033636530616239336133373361616165316131663934646661336666343031
      64653463373336386639333331396431316135313139636630386435316265366139363361656537
      39636161336439383239313532333363373565396364663461636532303035336461643635633165
      33333133653561363334356530333335663932623061366366616262306263626539636132393133
      38376363333334663861623962643166326538616534616338643833613365336639396130616465
      62393836353437303237393465633633663934613130316532386532333064386538366439656134
      386263386436623762363665373966386436
      """
  }

  mastodon_vapid_private_key: {
    "__ansible_vault":
      """
      $ANSIBLE_VAULT;1.1;AES256
      34633130343535333432333436613738373337356433336238616161313239376530383663366130
      3732656338646634656263636632616461663136336234390a356665633565653131343937326330
      61646133633061323164376165666231393234373266643836656561663838393735393738303037
      6665306434633234340a306362396535306464386232333332633739366139383430366266343930
      65333436343931616230393361653234376438313764333937616330353464373132373861356465
      3565323135626462313931613335633363643938396262373962
      """
  }
  mastodon_vapid_public_key: "BMRVNeG8Io07OP2yGLhhhIXiX-m7Tjjhws_RJ9b1BvBXTKj8wRn9XAyRBoeM04TUgj26qkdnrtBbcRh_XODZW3k="

  openssh_server_listen_port: ssh_port
  nginx_site_http_redirector_listen_port: http_port
  nginx_site_mastodon_front_listen_port: https_port

  nftables_accept_tcp_ports: [
    ssh_port,
    http_port,
    https_port,
  ]

  nginx_resolver: "8.8.8.8"

  private_ca_root_key_password: {
    "__ansible_vault":
      """
      $ANSIBLE_VAULT;1.1;AES256
      65643238353263343864366637323638333530396436616162336335373931663132326163373537
      3266356363343035653736653038346232363762653530380a326236353366333035646339343738
      34663037653261663864623838633666306637656434373039343730306262633530313832663262
      6361363331636461330a643332623336303566633031626132373038306331333564396538616431
      35613564633235333638613364376533303933356364326433303162663838326238
      """
  }
  private_ca_inter_tls_key_password: {
    "__ansible_vault":
      """
      $ANSIBLE_VAULT;1.1;AES256
      31393465656330363763313865313065353964653732383765666363333062646337306134363736
      6630373239353436373137303734663832653436323463360a333566386634373561383030353137
      36623138383665333930643164666463393139643035333139383763376261306262666539326139
      6263353737393262350a663666386337613736316431373561633938363232316163386637333065
      35303261326165653930373164643166396264383436333532646439363132336334
      """
  }
  private_ca_country_name: "JP"
  private_ca_state_or_province_name: "Tokyo"
  private_ca_locality_name: "."
  private_ca_domain: "ca-local.mizunashi.work"
  private_ca_listen_port: 80

  private_mastodon_certificate_fullchain:
    """
    -----BEGIN CERTIFICATE-----
    MIIC+zCCAqGgAwIBAgIBATAKBggqhkjOPQQDAjBgMQswCQYDVQQGEwJKUDEOMAwG
    A1UECAwFVG9reW8xCjAIBgNVBAcMAS4xEDAOBgNVBAoMB1ByaXZhdGUxCjAIBgNV
    BAsMAS4xFzAVBgNVBAMMDlByaXZhdGUgVExTIENBMB4XDTIzMDMyODE1MDkwMVoX
    DTI0MDMyNzE1MDkwMVowWzELMAkGA1UEBhMCSlAxDjAMBgNVBAgMBVRva3lvMRcw
    FQYDVQQKDA5taXp1bmFzaGkud29yazEjMCEGA1UEAwwabXN0ZG4tbG9jYWwubWl6
    dW5hc2hpLndvcmswWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAAQ4isSoVrx2P2p0
    2UcpXnDLrX0pf80D54EijigTuMCvRkXsUZSV02fgbU7TEHjvrXeyGMypNgToYn0d
    8N4robK1o4IBTzCCAUswHQYDVR0OBBYEFL3o1y94pt9i5jPQC5bMpcPe0vebMIGL
    BgNVHSMEgYMwgYCAFOwfIGL3GbusvOsdkiXw7lgXbjpeoWWkYzBhMQswCQYDVQQG
    EwJKUDEOMAwGA1UECAwFVG9reW8xCjAIBgNVBAcMAS4xEDAOBgNVBAoMB1ByaXZh
    dGUxCjAIBgNVBAsMAS4xGDAWBgNVBAMMD1ByaXZhdGUgUm9vdCBDQYIBATAJBgNV
    HRMEAjAAME0GCCsGAQUFBwEBBEEwPzA9BggrBgEFBQcwAoYxaHR0cDovL2NhLWxv
    Y2FsLm1penVuYXNoaS53b3JrOjgwL2ludGVyQ0FfVExTLmNydDBCBgNVHR8EOzA5
    MDegNaAzhjFodHRwOi8vY2EtbG9jYWwubWl6dW5hc2hpLndvcms6ODAvaW50ZXJD
    QV9UTFMuY3JsMAoGCCqGSM49BAMCA0gAMEUCIQDQVKKIkJIFPIeZ/CnpT6V7h8G/
    clU/jKON4LgaeaTz5wIgC2zUd8kKHqdLBYnoDhaPc+sADDayWUSa8Qov18T4Txk=
    -----END CERTIFICATE-----
    """
  private_mastodon_certificate_chain:
    """
    -----BEGIN CERTIFICATE-----
    MIIDADCCAqWgAwIBAgIBATAKBggqhkjOPQQDAjBhMQswCQYDVQQGEwJKUDEOMAwG
    A1UECAwFVG9reW8xCjAIBgNVBAcMAS4xEDAOBgNVBAoMB1ByaXZhdGUxCjAIBgNV
    BAsMAS4xGDAWBgNVBAMMD1ByaXZhdGUgUm9vdCBDQTAeFw0yMzAzMjgxNDUxMTZa
    Fw0yODAzMjYxNDUxMTZaMGAxCzAJBgNVBAYTAkpQMQ4wDAYDVQQIDAVUb2t5bzEK
    MAgGA1UEBwwBLjEQMA4GA1UECgwHUHJpdmF0ZTEKMAgGA1UECwwBLjEXMBUGA1UE
    AwwOUHJpdmF0ZSBUTFMgQ0EwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAAQPx9cw
    JkI67cRfP5k3fL0cb0cNWJ4EYbvFkaCQLF59JNdJw7PETClW4etGERIjNe0hunKB
    0SuY4a7KU9LnsGSHo4IBTTCCAUkwHQYDVR0OBBYEFOwfIGL3GbusvOsdkiXw7lgX
    bjpeMIGeBgNVHSMEgZYwgZOAFHYTwnFyIBsSTm073pvHMPBXY0o3oWWkYzBhMQsw
    CQYDVQQGEwJKUDEOMAwGA1UECAwFVG9reW8xCjAIBgNVBAcMAS4xEDAOBgNVBAoM
    B1ByaXZhdGUxCjAIBgNVBAsMAS4xGDAWBgNVBAMMD1ByaXZhdGUgUm9vdCBDQYIU
    al0TjvDyk5GBKJDaJzvtf5amdPUwSAYIKwYBBQUHAQEEPDA6MDgGCCsGAQUFBzAC
    hixodHRwOi8vY2EtbG9jYWwubWl6dW5hc2hpLndvcms6ODAvcm9vdENBLmNydDA9
    BgNVHR8ENjA0MDKgMKAuhixodHRwOi8vY2EtbG9jYWwubWl6dW5hc2hpLndvcms6
    ODAvcm9vdENBLmNybDAKBggqhkjOPQQDAgNJADBGAiEAu0TCpgwAs+iVfjuEXEJk
    Rv+QtbXfRTcrE3opNiatYJACIQDCiG8i1SS80PpcxOLu+bcs0NfJgt50aH2/pvDi
    mwYspg==
    -----END CERTIFICATE-----
    """
  private_mastodon_certificate_private_key: {
    "__ansible_vault":
      """
      $ANSIBLE_VAULT;1.1;AES256
      33366666623564663033366138666338303736363566616330313165653039306563303261373264
      3136633636363264373732616461313235363336643638620a626564393265633936623063306530
      33316664633938386266376463616661363839633731353931323638643235626562343435663464
      3962636362316261300a666136363764626466316465386431633836356436373665656562633438
      39306532313966313963326538616139626131656332626430393032373837386663336136666338
      65336336326235303937666364386132613064653038383864313631633962316163336232363130
      63623666396238383138306334393862316366333936306136393234353066336536353536353364
      31363363313936626664666462666132366132356437643534653230613838646335623238383265
      38313334343435376666396163616336316137323836353933306530633232383533613532666330
      33326161646239646661356234663134373137656664373530616262366162306632346432323937
      66336463663563613735363630633135626562393935306132393361323938303738333739326332
      63623764316438613636363166316565346530666633396130303663373762356136663334306630
      30333038653066366362346235643836646536323836363933393634343239613638613735663539
      62363564633430396666346261373761316462643535626261393736303261633464356663393662
      39303062363237363739326132343166396165626538353863616436383932343565626230613933
      30613763383532306461633762643936643230653833376561343433633165393164323937363130
      6266
      """
  }

  prometheus_scrape_configs: [
    {
      job_name: "node"
      static_configs: [
        {
          targets: [
            "localhost:9100"
          ]
          labels: {
            "service": "vagrant"
            "project": "primary"
            "hostname": "localhost"
          }
        }
      ]
    },
    {
      job_name: "nginx"
      static_configs: [
        {
          targets: [
            "localhost:9113"
          ]
          labels: {
            "service": "vagrant"
            "project": "primary"
            "hostname": "localhost"
          }
        }
      ]
    },
    {
      job_name: "redis"
      static_configs: [
        {
          targets: [
            "localhost:9121"
          ]
          labels: {
            "service": "vagrant"
            "project": "primary"
            "hostname": "localhost"
          }
        }
      ]
    },
  ]
}
